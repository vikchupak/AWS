# Firewall

- [Firewall in network](https://github.com/vikchupak/AWS/blob/main/network/network.md#firewall)
- [AWS Network Firewall](https://aws.amazon.com/network-firewall/)
  - Protects your VPC network traffic (Layer 3‚Äì4)
  - Sits inside your VPC, typically in a dedicated firewall subnet
- [AWS Web Application Firewall (AWS WAF)](https://aws.amazon.com/waf/)
  <img width="1265" height="714" alt="image" src="https://github.com/user-attachments/assets/c7622976-a94b-4f65-8112-f766f61d7624" />
  - Protects web applications (Layer 7)
  - Attaches to
    - Application Load Balancer (ALB)
    - CloudFront
    - API Gateway
    - AppSync
  - Web Access Control List (Web ACL) is the main configuration unit in AWS WAF
    - Web ACL is the container for Rules and Rule Groups you define
    - You can configure "inteligent" feedback loop based on logs generated by WAF to update Web ACL automatically
  - Can write logs to S3
  - Web ACL Capacity Units (WCU) - Default 1500
    - "Measurement" of Rules complexity
  - A resource can have ONLY one WEB ACL associated. But the same WEB ACL can be associated with many resources
  - Pricing
    - WEBACL - $/month
    - A rule on WEBACL - $/month
    - Requests per WEBACL - $/million

## It makes sense to use AWS Network Firewall with AWS WAF?

- It absolutely makes sense to use them together, because they protect different layers
- They are complementary, not competing services

### AWS Network Firewall

Protects:

* VPC traffic
* Ingress & egress
* TCP/UDP
* IP/port/protocol filtering
* Deep packet inspection
* Data exfiltration control

Works at **L3‚ÄìL4 (+ some L7)**.

### AWS WAF

Protects:

* Web applications only
* HTTP/HTTPS traffic
* SQL injection
* XSS
* Bots
* Rate limiting

Works at **L7 (application layer)**.

### Why Using Both Makes Sense

Imagine this architecture:

```txt
Internet
   ‚Üì
CloudFront
   ‚Üì
WAF  (blocks SQLi, XSS, bots)
   ‚Üì
ALB
   ‚Üì
VPC
   ‚Üì
Network Firewall (controls outbound + internal traffic)
   ‚Üì
EC2 / ECS / RDS
```

### What each protects:

| Threat                    | WAF | Network Firewall |
| ------------------------- | --- | ---------------- |
| SQL injection             | ‚úÖ   | ‚ùå                |
| XSS                       | ‚úÖ   | ‚ùå                |
| Block bad IPs             | ‚úÖ   | ‚úÖ                |
| Block port 22             | ‚ùå   | ‚úÖ                |
| Stop data exfiltration    | ‚ùå   | ‚úÖ                |
| Control east-west traffic | ‚ùå   | ‚úÖ                |

## üß† Simple Rule

* **WAF = protect the application**
* **Network Firewall = protect the network**
